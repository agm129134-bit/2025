<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Heap Tree 動畫（滑動）</title>
<style>
body { font-family: Arial; padding: 20px; }
input { width: 360px; }
button { margin: 5px; }

svg { border: 1px solid #ccc; background: #fafafa; }

.node circle {
    fill: #90caf9;
    stroke: #1565c0;
    stroke-width: 2;
}
.node.active circle {
    fill: #ffcc80;
}
.node {
    transition: transform 0.6s;
}
.edge {
    stroke: #555;
    stroke-width: 2;
}
text {
    font-size: 14px;
    font-weight: bold;
    text-anchor: middle;
    dominant-baseline: middle;
}
</style>
</head>
<body>

<h2>Heap 建堆（樹狀滑動動畫）</h2>

<input id="input" value="7,15,10,18,28,17,12,21,35,32">
<br>
<button onclick="start()">建立 Heap</button>
<button onclick="prev()">上一步</button>
<button onclick="next()">下一步</button>
<button onclick="auto()">自動播放</button>

<svg id="svg" width="900" height="420"></svg>

<script>
let steps = [], idx = 0, timer;

// ========== Heap ==========
const record = (a, h=[]) => steps.push({a:[...a], h});

function siftDown(a, i, end){
  while(i*2+1 <= end){
    let l=i*2+1, r=l+1, m=l;
    if(r<=end && a[r]>a[l]) m=r;
    record(a,[i,m]);
    if(a[i]<a[m]){
      [a[i],a[m]]=[a[m],a[i]];
      record(a,[i,m]);
      i=m;
    } else return;
  }
}

const buildHeap = a => {
  steps=[];
  for(let i=Math.floor(a.length/2)-1;i>=0;i--)
    siftDown(a,i,a.length-1);
};

// ========== Layout ==========
const pos = i => {
  let lv = Math.floor(Math.log2(i+1));
  let k = i-(2**lv-1);
  let gap = 900/(2**lv);
  return { x:gap*k+gap/2, y:lv*80+40 };
};

// ========== Render ==========
function render(step){
  const svg = document.getElementById("svg");
  const arr = step.a;

  // edges
  svg.innerHTML = "";
  arr.forEach((_,i)=>{
    let p=pos(i);
    [2*i+1,2*i+2].forEach(c=>{
      if(c<arr.length){
        let q=pos(c);
        svg.innerHTML+=`<line class="edge" x1="${p.x}" y1="${p.y}" x2="${q.x}" y2="${q.y}"/>`;
      }
    });
  });

  // nodes
  arr.forEach((v,i)=>{
    let {x,y}=pos(i);
    svg.innerHTML+=`
      <g class="node ${step.h.includes(i)?'active':''}"
         style="transform:translate(${x}px,${y}px)">
        <circle r="22"></circle>
        <text y="2">${v}</text>
      </g>`;
  });
}

// ========== Controls ==========
function start(){
  clearInterval(timer);
  idx=0;
  let a=document.getElementById("input").value.split(",").map(Number);
  if(a.some(isNaN)) return alert("輸入錯誤");
  buildHeap(a);
  render(steps[0]);
}
const next = () => idx<steps.length-1 && render(steps[++idx]);
const prev = () => idx>0 && render(steps[--idx]);
const auto = () => {
  clearInterval(timer);
  timer=setInterval(()=>idx<steps.length-1?render(steps[++idx]):clearInterval(timer),700);
};
</script>

</body>
</html>
